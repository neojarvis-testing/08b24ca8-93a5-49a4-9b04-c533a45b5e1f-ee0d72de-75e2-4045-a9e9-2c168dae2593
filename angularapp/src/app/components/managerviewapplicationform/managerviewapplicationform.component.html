<div class="background-wrapper">
  <div class="container">
    <h1>Manage Plan Applications</h1>
    <div class="search-bar-wrapper">
      <input 
        type="text" 
        class="search-bar" 
        placeholder="Search by Plan Name" 
        [(ngModel)]="searchPlanName" 
        (input)="filterApplicationsByPlanName()">
    </div>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>S. No</th>
          <th>Applicant Name</th>
          <th>Plan Name</th>
          <th>Applied Amount
            <span class="sort-btn-container">
              <button class="sort-btn" (click)="sortAmountAscending()">&#9650;</button>
              <button class="sort-btn" (click)="sortAmountDescending()">&#9660;</button>
            </span>
          </th>
          <th>Application Date</th>
          <th>Remarks</th>
          <th>Status</th>
          <th>Proof of Document</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let planApplication of filteredPlanApplications; let i = index">
          <td>{{i + 1}}</td>
          <td>{{planApplication.user?.username}}</td>
          <td>{{planApplication.savingsPlan?.name}}</td>
          <td>{{planApplication.appliedAmount | currency:'INR':'symbol':'1.0-0'}}</td>
          <td>{{planApplication.applicationDate | date:'dd-MM-yyyy'}}</td>
          <td>{{planApplication.remarks}}</td>
          <td>
            <div *ngIf="planApplication.status === 'Pending'" class="action-buttons">
              <button class="approve-button" (click)="approve(planApplication)">Approve</button>
              <button class="reject-button" (click)="reject(planApplication)">Reject</button>
            </div>
            <div *ngIf="planApplication.status !== 'Pending'">
              <span [ngClass]="{ 
                'approved-status': planApplication.status === 'Approved', 
                'rejected-status': planApplication.status === 'Rejected' 
              }">
                {{planApplication.status}}
              </span>
            </div>
          </td>
          <td>
            <button class="view-button" (click)="showPopup = true; popupImageSrc = planApplication.ProofDocument">View</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Popup Modal -->
  <div class="popup" *ngIf="showPopup">
    <div class="popup-content">
      <span class="close" (click)="showPopup = false">Ã—</span>
      <img [src]="popupImageSrc" alt="Document Proof">
    </div>
  </div>
</div>